@inject ILogger<AudioSetupPanel> Logger

<MudPaper Class="pa-4" Style="height: 100%; background-color: #2c2c2c;">
  <MudText Typo="Typo.h5" Class="mb-4">Audio Setup</MudText>
  
  <MudStack Spacing="3">
    <MudSelect T="string" Label="Input Source" @bind-Value="SelectedInput" Variant="Variant.Outlined">
      <MudSelectItem Value="@("Radio")">Radio (Raddy RF320)</MudSelectItem>
      <MudSelectItem Value="@("Vinyl")">Vinyl Turntable</MudSelectItem>
      <MudSelectItem Value="@("Spotify")">Spotify</MudSelectItem>
      <MudSelectItem Value="@("Local")">Local MP3s</MudSelectItem>
    </MudSelect>

    <MudSelect T="string" Label="Output Destination" @bind-Value="SelectedOutput" Variant="Variant.Outlined">
      <MudSelectItem Value="@("Local")">Local Speakers</MudSelectItem>
      <MudSelectItem Value="@("Cast")">Google Cast</MudSelectItem>
    </MudSelect>

    @if (SelectedOutput == "Cast")
    {
      <MudSelect T="string" Label="Cast Device" @bind-Value="SelectedCastDevice" Variant="Variant.Outlined">
        @foreach (var device in AvailableCastDevices)
        {
          <MudSelectItem Value="@device">@device</MudSelectItem>
        }
      </MudSelect>
    }

    <MudDivider />

    <MudText Typo="Typo.h6">Transport Controls</MudText>
    
    <MudStack Row="true" Justify="Justify.Center" Spacing="2">
      <MudIconButton Icon="@Icons.Material.Filled.SkipPrevious" Color="Color.Primary" Size="Size.Large" OnClick="OnPrevious" />
      <MudIconButton Icon="@(IsPlaying ? Icons.Material.Filled.Pause : Icons.Material.Filled.PlayArrow)" 
                     Color="Color.Primary" Size="Size.Large" OnClick="OnPlayPause" />
      <MudIconButton Icon="@Icons.Material.Filled.SkipNext" Color="Color.Primary" Size="Size.Large" OnClick="OnNext" />
      <MudIconButton Icon="@Icons.Material.Filled.Stop" Color="Color.Error" Size="Size.Large" OnClick="OnStop" />
    </MudStack>

    <MudStack Spacing="2">
      <MudText Typo="Typo.body2">Volume</MudText>
      <MudSlider @bind-Value="Volume" Min="0" Max="100" Step="1" Color="Color.Primary" />
      
      <MudText Typo="Typo.body2">Balance</MudText>
      <MudSlider @bind-Value="Balance" Min="-100" Max="100" Step="1" Color="Color.Primary" />
    </MudStack>
  </MudStack>
</MudPaper>

@code {
  private string SelectedInput { get; set; } = "Radio";
  private string SelectedOutput { get; set; } = "Local";
  private string SelectedCastDevice { get; set; } = "";
  private bool IsPlaying { get; set; } = false;
  private int Volume { get; set; } = 75;
  private int Balance { get; set; } = 0;

  private List<string> AvailableCastDevices { get; set; } = new()
  {
    "Living Room Speaker",
    "Kitchen Display",
    "Bedroom Speaker"
  };

  private void OnPlayPause()
  {
    IsPlaying = !IsPlaying;
    Logger.LogInformation("Play/Pause toggled. IsPlaying: {IsPlaying}", IsPlaying);
    // TODO: Connect to audio service
  }

  private void OnStop()
  {
    IsPlaying = false;
    Logger.LogInformation("Stop pressed");
    // TODO: Connect to audio service
  }

  private void OnPrevious()
  {
    Logger.LogInformation("Previous pressed");
    // TODO: Connect to audio service
  }

  private void OnNext()
  {
    Logger.LogInformation("Next pressed");
    // TODO: Connect to audio service
  }

  protected override void OnInitialized()
  {
    // TODO: Load available cast devices from cast service
    // TODO: Load current audio settings
  }
}
